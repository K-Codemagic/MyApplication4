workflows:
    native-android:
        name: Native Android
        instance_type: mac_mini
        environment:
            vars:
                # Android Keystore environment variables
                CM_KEYSTORE: Encrypted(Z0FBQUFBQmhFVmRzejJGcEt2dmkwd1psUTdzcm5HSkpqTWxtd3dkZTlYUkk1ZFVKNmJWUEk4ZWhRaVFaNUVsS0JkMnRDYWZ2TEpsZG51d0lNLVZsRFZMZHpvMmI0X2E1eHZoeGxRNXZOUFFlcEhGQlE2RWdWR1lCZjhNcGtodjlBVzlpdEpYbTVYd2RJVTJNbjI3V2pIMUNqNzJwb0NjNnNBa0xqMXlkQ1hZbXJKLTJiUk1GcUk0TGZXUzFEaWR0M2xLVngwcUZ3YnpwQldacU5pLWZwb0JrWjI1SHRULTRQQUZiYVp2dm9rcnU2Vl9TUGFGVXVOREVITTJ5UUptUmVPUzFELVc4QzZ2cWtLdFhJWUMwWWRfWTRjNGJoQXBSbXBlSG56eXNuX1BSTlZhZDRja3JpaWxLNHNCc3hNWmNBcE5hRkZ4TlNnQ01QenU3ZHJucXIwN2lkV3Rpbko4VVFlWWRNSDhiYV9SMXVLeHRieEYzLUtfMUJaS0VxdEQxTzdFLUtQT00zNm5JTF8zZzh2Vk4yd2JYZndSWmpBam94VHZnRW5LRHh6cy1HNUpJcVkxbk5qT2IxMTdlLVk1Y0JvZGtUV0VKSi1Xb2FuVkdJenp1aXNObGRTSUxSZjB5WWFlWGJPcXpEeG1yMEFPUzVUZTRzTXcxUm5QMm5tRk5OY2JaMWp4NXlGclNLWEhkb2FhbU95VEg5dDBkcmlQbU11Ui1aU3h1UUk0LXVRTU9YMjNNSHlvSVFuQ0I1aWJVcFdOV1BLTkx0dlpSdXktWUVnbTJ1d1BQY281WWVtY0ZJTU5aSmpiQ1BYdy13NzlucEVsLS1VS1NxaFQxT21HWExPbEFPTE1GT0ZzR1BMZWQ2b0JnQThZNkdnZUNvcV9RZVp3QmtZaHZpYVE0TkRReS1tZjdqWnFnb01Uclc5YVEwQlZ1R1BoRTZlNnRCUE0wR0J4aHVsYWRWQXZKNVpaVWljYnBTWmVGLVVXUURXYWE5TWViMmNVQzJKb1RCVWoxUUgyeTd1RU1HQlFGaHQta0hKdmplaWwzZi1uMjJQLU01RVN6Z2FibnFackNTcHpKZ1JtdmNIZnVIYmNUallGQk5GZkFKcWRzR0hDZENvOU5XVWJrWnZ6YUZGY1BhVkFlMnlRY1RBZV9NQWI3NURPNHBzWTlRM3lUZHotUGZpTlJacFRqYWN2RVdBNUItWExQWGZFaTNpbEVNMGE4SnhFNXVnYm55UFVSLVU2bDZUcGlGOHd1YjE2aTB4aUJsaVEwYWhnNDdCMC1tcEItYVdwcjhuVmM4dl9IV1dIbFR1cnRrWE1uUnN1T1k5RldINl9hYlhqT3FETEVOVVM4WGM0Zm9rdF9NR3NtVWNmdzZfd0ZRX3RKVGowMU9HZmNQMTlKNzVBUzR0Yjc2cncyZjRvbHVoNFA3RFlYWUdzckp6YTU1R19kTHRHenpIRVFZVnFNMWlaRXNhVFNQcVFvaDlJVDM5MmVEYjg0cGtVT2VaT1hyWFg1MDZyUWJjRENCTE14c2xYLWlxdHlleDBWSUk2c3I1LWNqd3lOVjBSZThsZU1NOEExamIxaWd2U1hleVdjdlN0RkNSMWQxTUV2YmU3a1V3OHJDeTdMcEd3ZDRhOUprNl9MazZGNWttLUdYcjRwZkhyNXF0YVNmaDEybkZPWkxZVW0xOW9iTmxWSVBuZHBCMnlNcGtHbnBIZ3lxLWc2R1RnZEFuZ2EtaUh4SHUyMzZYTXAtRTJMc2JydUh5dTIzaHkxQjV5NlF6MDUwdkczbVdTRkVhX0hnbWVWXzMtSFA2UGFtLWRrM0dhRWppWjRFUE1ObUNqOTFsY0o3N1BGWks2NS1oYmktZ2dRS3dnOXl1NWZhamphcW0zbGRLZTUtTklRYzZCNkVqMnp5Mkc3MGhIbkVTUm9GSWRSVWw0NDBFTm9yT3h2V0VqeEZLSDBrYXdVZThTMnZjUmF3THVobVNQdloyaXUyMklveF85VFRDdEl6bTlkMVBUVzRYbklBNElKNTlHbWZaT3FiRGJtQXotQ2dXUTdSWGp5Ui1md2RXQzAwZmlFeXlZeEtZVmEyb3JTLUVQbGNBVDBGdHFWRFFoNFhiZlFPTHFOYlVJMzhuVmpfTm1BUFJodVZtTm1mb2xFbXprUk5MbUNjSndJeFdGeFRab1NPaVc1QmlJRGFFb05jYmNXTkRmbTN2d1BMU3QyekFnTU9RMUY5cXg3NEZFM0xPWUFwbXpUVkFuQ2o0b0pVdTE0ZTdEYzgyZHFyZ1JGOE1OdXdUZE9HS2RuTy10Q01SdlNXdXd4NzFJLVplaFJVYmp3WEUyMUU1bDZaYWRKVEJSUXZUMTB5S2o1OExtQWtlSzYwbmdVclBRX05sNFJyNUdYN1ZGSUNuZ1VvNFBJTjhxQnNxc1I2X2NnZXZ6dWpOR2FLSXlaZTdpN1h0YlY5dWN6ME01Z19WcWlqZHFOWlpOdDJRTXh6dDhXN0dDQ25Xc3NCeC1RUmhfOXpiZFJsalUxTkl0Zm9wUWpLal9WY3hRSXAzOElOalVvR2p1SlB1akR0VTlFd3BsVXg4YjdrdGExclVteElFQ1Rzc3Nucm5BcEUtWGZ3WE41OXVyczVqOUtNS0QzSTNmV3haV2tHdl91VXFTcDRJZjhqdHdZV2tmWHRBekswekdjbjhwS0RLZVl2Y3BjcnJFRExKWE81U25WNmRiaFNuMzBMdXNWV3BEUUJ4N3BzLUVJVS15YTBzN25hLVN0azVwbHotODBkRE45VXdMSmtkX19YT09sNlFka1ppX3dlTHN5TVBjNlRESllUUEJDV3lFRUU0WDZYMGhTWHowTzBDUkFwaG5iR1B6VkxNMXdsQXdxVzZRMXRFQWs2LXBZaGVicDJBWmJyeWNSSEVaeE9PZ04tclhUUzMtX0JCT3NobmFNZ3IwOEVGRzFrWlBYd1ZFSndDTkFTQ1JvQU16OTlvTEZqOVFOTl9jbnZIMzFrSDBtVXI0OU5nNkJYbVF4eDNESjNYY1dQU0w2ekdRNnlYOW1fdkZkZ0FseFh6MWpYMGZXQzM2ejRxWWh2SFplZG5qM0szZ0Q5LW9aX09Kc3FIaG9wWHhyVUxoYkFwNXh1QUxLMXFSMkdMdHFYVGFJeVRyX3NwV1c1WjJVZ1piUlh4cDB6akc0VFRGVG9uVDNabkE4d29yYWE0MXJwMUFjNEhiNHptTmVkWEtwZnE4M2NWQVVTa0tlbW5JOEk0RnpKdzQzMm44bjYzVFEwUnlkNDNEY1dPTGJfNmRaVEJ1TjBlRlhUbWlzbVlSZzFUOTFvWmFaVDBKOTNvV3Vmei1maU9VZXVKc3ItU3BYQlVhYkZpUk5fOTZpSzd4R3VlR2Fzd3JsVVJ4elB5WF9URUpnWTBfRmxjWWZWUGJRMEtQOWxTWmpHckRUbVpWc3VFVm5Dcllid0JITjVaMGpSdjJhWGU5emd2eEstVWNuSkFGS212enFKbVA1M3ZIbHlTYVg2dTd2QUNyaEt2OHZ6LVJTOUJUUUVhUEM5VGVEemZvNjFlR0FsWDhtbVJ6cFpvTTN1RHB1VUNmUlpGOTRDeXJyTkhTMzdINERQZ0VDbVJOWU4tT0l5bjluVEpCWURSRGoxdTJEOWdIY3BZd1BLVDAzUUNDS2czWDFRVHlSOGZaaDNoQ2FZalBLMW1paHZMRGxFcEY5RHZiX25TZnJmc0p6ckxsNlNERjg3dGxxMU8yaUhvTmp0dTdSWnFoeFRmdzJna2JvM3I5WnVpeUZRU1F0Q09Ib3VDZUU3X1g1aDJ6VjlhOTJhdWMwRDFwdVhNUEhCdThuQkkwcUVmZW9acDJhakd5Ni1zU3ViY2NHSTYxRGVsMkxHNWRRNWFaTUtVSjd3YVQwNlVkMlAtdE9iTHJpM0czbmZ3Uk5QNjJVV2J4Rmd2d3pXRHJ0elpVN21pV2pkaFkxamlaUjhKcWZYb3pPZFFvSFBwU1hKRVRTYlhENE5PaS1saGE1VElEdmtoVmJFd3NNU0h4bWI0T1hzVEhGdVdQY000WVU4cjBhSUZLbGtTVl9fb2RLNExHYVRZWk9GclhjUjFWZkRWLVQwS21MZWY5RjRab01yMFhhN3YwZWtnYzNwdkJ6OXl0MU1Qd0pFYnE5bFB1QjBQR2xzUkk3V0JMQ053MVFWVWg3cVp1Q1pFU1ozN1pFTVJmdFJnYjlod2g5X282NE5NZWtjbXdjTi1NV1ROZVhUUk85engzZk00a0laSnJsMTEwQzZHempSdHFka2lzN09XS2s0cDRRRmhacFp4VjduenUxemRDb1R6Qjlkb3ZGZV9xU3h1cjcyVG5HXzg2QnpQVUhjdTM0X0w5M0d5empLU0RZNTU1Z2NDcTVtWlNYbmktcDRab0h3TkZyVzNUS2JJU3dMQnFnaTZmZXNlaC1XcFZhQ3o2VFRDeWFJajFvcHRmQkc1VlNrdlpTekEzcXRuS1Jyb205RDA4emRSbjIyakJITWlBQmdnbTlqd3pBNmt3dzBaS2tHNTE3OFlvbTFNc1FCQmpfRkNfcTVNQkRNWHFPOG1vbFcybTVtU1ZGV0xIaFRJR21qZVl3bmg1b0xJRE01dzRSUm9kMkhVRlJwSGlWT1kweGxGMVBJQUE0czdZa3ZVWkpWNkJ1aUxjNEY1dXk4LVZYdXFLRTBieVBFb3BvbG5HNEFBcUk2ZG1IbmVWVElvT1poZzBqXzFFNXFVWGJPeGtPUHB1SjVCMldWd2t6Qm11alR4WXd6cVZPc1J3dEhhVFN0a0lwblJaUkdwaS1VU0d5SkNsYml0NDV6MmZnX1NWZzlITVNPd1dZRk9TcE5XWWdLM0R3eHh2YTdadjYtaHVjTVVNQW9KVFJ0TTZ3cjJvREw5LWtRei1pYlYtZkhMeVN5Ti1VSGt2M2o4S1JZVEQ1VzM3bmtHM09ZMTVPVGN0b2g3bEQzcUtYN1FtdUt6Q25sY1E5bi1EV0FaYlRFR0dOWVRRa1JDbV9KSV9DZ19rdlJSbVg1NDJOazRWQ2ZyVlk3dm9zVXd5bXNJY3FGWmZ5Wi1WLW8zNkJ1YjVWeEh3Y3pSbUJGeFJ1MFdaX2VjT2hxUmNyZXB5VXhBOWZHQjNYN3VZai1ROHVjVTUxV0gzVkhkUV8ySWUyOThaRTlwblFuNl9uSHd4YXhRTk5zVXBfXzZpOU9CTkI5aGtUSVRHYVNMTUtvcjl3NlIxbndJZUFRdTN3Q3RWWi1kaXhqalBjdFFPdEJrcmg2U0p0RHpfTklXelM5VUlBZFMtVi1OWXdrdEtHZ21aTFA5Q1BqejhURUNwcWgwcGZkbDQwaUh6emZWcm0tUWxQZ3NBPQ==)
                CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmhFVmVmWHNMRnBvR2h6OXRUTzQ2LWNrVTQ1RENGUzYzbjZNZHA2TG14V3BhYU5oeTBPMzRDZjNDM1ZSSHRLOTR1YjdHTVQ4NDFTenFCT3dHS3ZCTmdqTk9vM1E9PQ==)
                CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmhFVmVmWHNMRnBvR2h6OXRUTzQ2LWNrVTQ1RENGUzYzbjZNZHA2TG14V3BhYU5oeTBPMzRDZjNDM1ZSSHRLOTR1YjdHTVQ4NDFTenFCT3dHS3ZCTmdqTk9vM1E9PQ==)
                CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmhFVmVmWHNMRnBvR2h6OXRUTzQ2LWNrVTQ1RENGUzYzbjZNZHA2TG14V3BhYU5oeTBPMzRDZjNDM1ZSSHRLOTR1YjdHTVQ4NDFTenFCT3dHS3ZCTmdqTk9vM1E9PQ==)
            node: latest
            xcode: 12.2
        triggering:
            events:
                - push
                - tag
                - pull_request
            branch_patterns:
                - pattern: develop
                  include: true
                  source: true
        scripts:
            - name: Set Android SDK location
              script:
                echo "sdk.dir=$ANDROID_SDK_ROOT" > "$FCI_BUILD_DIR/local.properties"
            - name: Set up keystore
              script: |
                    echo $CM_KEYSTORE | base64 --decode > /tmp/keystore.keystore
                    cat >> "$FCI_BUILD_DIR/key.properties" <<EOF
                    storePassword=$CM_KEYSTORE_PASSWORD
                    keyPassword=$CM_KEY_ALIAS_PASSWORD
                    keyAlias=$CM_KEY_ALIAS_USERNAME
                    storeFile=/tmp/keystore.keystore
                    EOF
            - name: Build Android
              script: |
                chmod +x ./gradlew
                ./gradlew assembleRelease
                ./gradlew bundleRelease
        artifacts:
            - app/build/outputs/**/*.apk
            - app/build/outputs/**/*.aab
        publishing:
            email:
                recipients:
                    - kalgi@nevercode.io
                notify:
                  success: true
                  failure: false
